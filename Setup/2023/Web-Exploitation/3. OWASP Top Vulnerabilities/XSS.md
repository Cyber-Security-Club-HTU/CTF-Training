# Cross Site Scripting (XSS)

## About

This vulnerability occurs when the website renders our input to the browser without doing any *sanitization* on it.
We can then insert HTML tags and JavaScript code, and having them executed to do some malicious activity.

---
## XSS Vulnerability Classes

1. **Reflected:** It is when our injected payload isn't saved on the page. This means that, if we closed the page and reopened it, the payload wont be executed again. So, it is *client-side*.
2. **Stored:** When our payload is saved nd *stored* in the webserver database. So whenever we open the page, it will get the payload from the database and render it on the browser, thus, executing it.

---
## Example

This website gets the value passed through `name` GET parameter and display it on the website.
```PHP
<?php
	echo "<p>Hi " . $_GET["name"] . " !</p>";
?>
```

It is obvious that the developer blindly trusts the user input. We can abuse this to inject malicious code.

![[Pasted image 20231017144833.png]]

---
## Crafting Payloads

We will encounter many restrictions and filtration on our input out in the wild. So, it is essential to be able customize your payload in order to bypass the *WAF* and achieve your goal.

**Where to put my JS code?**

- Between `<script>` HTML tags. Example: `<script>alert(1)</script>` .
- As an attribute for HTML tags. Example: `<img srs='this_is_not_a_url_even' onerror=alert(1)>` .

**Common attribute to place you JS in:**
- `onerror` .
- `onload` .
- `onmouseover`

**Symbols used in elements:**
- `'` and `"` are used to start/end strings.
- `<` and `>` are used to start/end HTML tags.

---
## Payload cases

1. **Inside the tag:**

If your input gets inserted into `<p>` tag for example, you can easily inject your tags directly without any worries.
```HTML
<script>alert(document.location)</script>
```

2.  **Ending an attribute:** 

If your input gets into a tag attribute like `src` for `<img>` tag: 
```HTML
<img src="my_input">
``` 
you should end the attribute string, and use one of the above mentioned attributes to place your payload.
```JS
bb" onerror="alert(1) junk_attr="b
```
*Dividing the payload:*
- `bb"` : It will fill the `src` attr with (bb) and then it will end it the string.
- `onerror="alert(1)` : your payload in one of the attributes.
- `junk_attr="b` : even if we had manually ended the string through double quotes (`"`), it will still end our input by double quotes (`"`) automatically. So, the only way to do this without any errors, is by defining any attribute and give it any string value without ending it with the double quotes (`"`), because the application will do that by default. 

3. **Ending a tag:**

For example, if your input gets inserted into the `href` attribute inside the `a` tag:
```html
<a href="my_input"></a>
```
You can end the `<a>` tag and place your `<script>` tag, as shown below:
```html
"><script>alert(1)</script>
```
*Dividing the payload:*
- `"` : It will end the ("my_input") string.
- `>` : Close the `<a>` tag.
- `<script>alert(1)</script>` : Place your code.

---
## Notes

- Escape the filtration by a mix of capitalization.
- Escape the filtration by URL encoding.
- Escape the filtration by double URL encoding.
- Spaces are not allowed in URLs. Use the `+` symbol or the `%20` instead of it.
- Make sure that your payload is correctly crafted.